# 腾讯云 1Panel 部署指南

本指南详细介绍如何在腾讯云服务器上使用 1Panel 面板部署 `city-survival-line` 项目，使其可以通过公网访问。

## 1. 1Panel 面板安装

### 1.1 服务器准备

- 腾讯云服务器：Ubuntu 20.04 LTS 或 CentOS 7+
- 至少 1 核 CPU、1GB 内存、20GB 存储空间
- 已开放 80、443、14332 端口（1Panel 默认端口）

### 1.2 安装 1Panel

```bash
# Ubuntu/Debian 系统
curl -sSL https://resource.fit2cloud.com/1panel/package/quick_start.sh -o quick_start.sh && bash quick_start.sh

# CentOS 系统
yum install -y wget && wget -O quick_start.sh https://resource.fit2cloud.com/1panel/package/quick_start.sh && sh quick_start.sh
```

安装过程中会提示设置管理员账号和密码，请记住这些信息，用于登录 1Panel 面板。

### 1.3 访问 1Panel 面板

安装完成后，通过浏览器访问：
```
http://your-server-ip:14332
```

使用设置的管理员账号和密码登录。

## 2. 环境配置

### 2.1 安装 Node.js

在 1Panel 面板中：

1. **打开应用商店**：点击左侧菜单「应用商店」
2. **搜索 Node.js**：在搜索框中输入「Node.js」
3. **安装 Node.js**：选择合适的版本（推荐 18.x 或更高），点击「安装」
4. **配置 Node.js**：按照提示完成安装配置

### 2.2 安装 Nginx

1. **打开应用商店**：点击左侧菜单「应用商店」
2. **搜索 Nginx**：在搜索框中输入「Nginx」
3. **安装 Nginx**：选择稳定版本，点击「安装」
4. **配置 Nginx**：按照提示完成安装配置

## 3. 项目部署

### 3.1 创建网站

1. **打开网站管理**：点击左侧菜单「网站」→「网站管理」
2. **创建网站**：点击「创建网站」按钮
3. **填写网站信息**：
   - 网站名称：city-survival-line
   - 域名：输入你的域名（如无域名，可使用服务器 IP）
   - 根目录：选择或创建目录，如 `/www/wwwroot/city-survival-line`
   - 类型：静态网站
   - PHP 版本：无需 PHP，选择「无」
   - 数据库：无需数据库，选择「无」
4. **点击创建**：完成网站创建

### 3.2 部署项目代码

#### 方法一：通过 Git 部署

1. **打开网站详情**：点击创建的网站进入详情页
2. **选择代码部署**：点击「代码部署」选项卡
3. **配置 Git 部署**：
   - 仓库地址：`https://github.com/aaronchenhao/urban-survival.git`
   - 分支：master
   - 部署目录：`/www/wwwroot/city-survival-line`
   - 构建命令：`npm install && npm run build`
   - 构建输出目录：`dist`
4. **点击部署**：开始部署项目

#### 方法二：手动上传部署

1. **本地构建项目**：
   ```bash
   # 本地执行
   npm install
   npm run build
   ```

2. **上传构建文件**：
   - 在 1Panel 面板中，点击左侧菜单「文件」
   - 进入网站根目录 `/www/wwwroot/city-survival-line`
   - 删除目录中的默认文件
   - 点击「上传」按钮，选择本地 `dist` 目录中的所有文件上传

### 3.3 配置网站

1. **打开网站详情**：点击创建的网站进入详情页
2. **选择配置**：点击「配置」选项卡
3. **修改 Nginx 配置**：
   ```nginx
   server {
       listen 80;
       server_name your-domain.com; # 替换为你的域名或服务器 IP
       
       root /www/wwwroot/city-survival-line/dist;
       index index.html;
       
       location / {
           try_files $uri $uri/ /index.html;
       }
       
       # 静态资源缓存
       location ~* \.(css|js|jpg|jpeg|png|gif|ico|svg)$ {
           expires 30d;
           add_header Cache-Control "public, max-age=2592000";
       }
       
       # Gzip 压缩
       gzip on;
       gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
       gzip_vary on;
       gzip_comp_level 6;
       gzip_min_length 1000;
       gzip_buffers 16 8k;
   }
   ```
4. **保存配置**：点击「保存」按钮
5. **重载 Nginx**：点击「重载」按钮使配置生效

## 4. 域名配置（可选）

### 4.1 域名解析

1. **登录腾讯云控制台**：进入「域名管理」
2. **选择域名**：点击需要配置的域名
3. **添加解析记录**：
   - 记录类型：A
   - 主机记录：@（或其他子域名）
   - 记录值：服务器 IP 地址
   - TTL：默认值即可
4. **保存配置**：等待 DNS 解析生效（通常需要 10-30 分钟）

### 4.2 HTTPS 配置

1. **打开网站详情**：点击创建的网站进入详情页
2. **选择 SSL**：点击「SSL」选项卡
3. **申请 SSL 证书**：
   - 点击「申请证书」按钮
   - 选择「Let's Encrypt」
   - 填写邮箱地址
   - 选择需要申请证书的域名
   - 点击「申请」按钮
4. **配置 SSL**：
   - 申请成功后，点击「配置」按钮
   - 选择申请的证书
   - 点击「确定」按钮
5. **强制 HTTPS**：
   - 在 SSL 配置页面，开启「强制 HTTPS」选项
   - 点击「保存」按钮

## 5. 服务管理

### 5.1 查看网站状态

1. **打开网站列表**：点击左侧菜单「网站」→「网站管理」
2. **查看状态**：在网站列表中查看网站状态，确保显示为「运行中」

### 5.2 重启服务

1. **打开网站详情**：点击创建的网站进入详情页
2. **重启服务**：点击「重启」按钮

### 5.3 项目更新

#### 方法一：通过 Git 部署更新

1. **打开网站详情**：点击创建的网站进入详情页
2. **选择代码部署**：点击「代码部署」选项卡
3. **点击重新部署**：选择「重新部署」按钮，等待部署完成

#### 方法二：手动更新

1. **本地构建项目**：
   ```bash
   # 本地执行
   git pull
   npm install
   npm run build
   ```

2. **上传构建文件**：
   - 在 1Panel 面板中，点击左侧菜单「文件」
   - 进入网站根目录 `/www/wwwroot/city-survival-line/dist`
   - 删除目录中的所有文件
   - 点击「上传」按钮，选择本地 `dist` 目录中的所有文件上传

## 6. 安全设置

### 6.1 防火墙配置

1. **打开安全**：点击左侧菜单「安全」→「防火墙」
2. **添加规则**：
   - 端口：80
   - 协议：TCP
   - 备注：HTTP
   - 点击「添加」按钮

3. **添加 HTTPS 规则**：
   - 端口：443
   - 协议：TCP
   - 备注：HTTPS
   - 点击「添加」按钮

### 6.2 网站权限设置

1. **打开文件管理**：点击左侧菜单「文件」
2. **进入网站目录**：进入 `/www/wwwroot/city-survival-line`
3. **设置权限**：
   - 选中 `dist` 目录
   - 点击「权限」按钮
   - 所有者：www
   - 所有者组：www
   - 权限：755
   - 点击「确定」按钮

## 7. 部署验证

### 7.1 访问验证

在浏览器中访问：
- 使用 IP 地址：`http://your-server-ip`
- 使用域名：`http://your-domain.com` 或 `https://your-domain.com`（如果配置了 HTTPS）

### 7.2 功能验证

1. 检查页面是否正常加载
2. 检查所有资源是否正确加载（无 404 错误）
3. 测试游戏功能是否正常
4. 检查背景图片是否显示
5. 检查音效是否正常

## 8. 常见问题排查

### 8.1 404 错误

- 检查网站根目录配置是否正确，确保指向 `dist` 目录
- 检查 `dist` 目录是否存在且包含正确的文件
- 检查 Nginx 配置中的 `try_files` 指令是否正确

### 8.2 502 错误

- 检查 Nginx 配置是否正确
- 检查服务器资源是否充足
- 查看 Nginx 错误日志：在 1Panel 面板中，点击网站详情 →「日志」选项卡

### 8.3 资源加载失败

- 检查 `vite.config.ts` 中的 `base` 配置是否为 `'./'`
- 检查构建后的资源路径是否正确
- 检查网站文件权限是否正确

### 8.4 HTTPS 配置问题

- 检查域名解析是否正确
- 检查 SSL 证书是否过期
- 检查 Nginx HTTPS 配置是否正确

## 9. 性能优化

### 9.1 启用 Gzip 压缩

在 Nginx 配置中已添加 Gzip 压缩配置，可提高网站加载速度。

### 9.2 启用浏览器缓存

在 Nginx 配置中已添加静态资源缓存配置，可减少重复请求。

### 9.3 使用 CDN（可选）

1. **登录腾讯云控制台**：进入「CDN」服务
2. **添加加速域名**：
   - 加速域名：输入你的域名
   - 源站信息：选择「IP 源站」，填写服务器 IP
   - 其他配置保持默认
3. **配置 CNAME**：按照提示在域名管理中添加 CNAME 记录
4. **等待部署**：CDN 配置部署完成后生效

## 10. 监控与维护

### 10.1 网站监控

1. **打开监控**：点击左侧菜单「监控」
2. **查看网站监控**：在监控页面查看网站访问情况、响应时间等指标

### 10.2 日志查看

1. **打开网站详情**：点击创建的网站进入详情页
2. **查看日志**：点击「日志」选项卡，查看访问日志和错误日志

### 10.3 定期维护

- **备份网站**：定期使用 1Panel 的备份功能备份网站
- **更新系统**：定期更新服务器系统和软件
- **更新项目**：定期拉取最新代码并重新部署

## 11. 部署清单

- [ ] 腾讯云服务器已准备
- [ ] 1Panel 面板已安装
- [ ] Node.js 环境已配置
- [ ] 网站已创建
- [ ] 项目已部署
- [ ] Nginx 配置已完成
- [ ] 域名已配置（可选）
- [ ] HTTPS 已配置（可选）
- [ ] 安全设置已完成
- [ ] 部署验证已通过

## 12. 相关操作

### 12.1 1Panel 常用操作

- **重启面板**：点击右上角「设置」→「重启面板」
- **修改密码**：点击右上角「设置」→「修改密码」
- **查看系统信息**：点击右上角「设置」→「系统信息」

### 12.2 网站常用操作

- **暂停网站**：在网站列表中，点击「暂停」按钮
- **删除网站**：在网站列表中，点击「删除」按钮
- **复制网站**：在网站列表中，点击「复制」按钮

## 13. 总结

本指南提供了在腾讯云服务器上使用 1Panel 面板部署 `city-survival-line` 项目的完整步骤，从 1Panel 面板安装到项目部署验证。通过按照本指南操作，你可以成功在腾讯云服务器上部署项目，并通过公网访问。

1Panel 面板提供了直观的图形化界面，大大简化了服务器管理和项目部署的过程，适合不熟悉命令行操作的用户使用。

如果在部署过程中遇到问题，请参考本指南中的「常见问题排查」部分，或咨询腾讯云技术支持。
